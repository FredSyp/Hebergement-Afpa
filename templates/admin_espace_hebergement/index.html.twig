{% extends 'base.html.twig' %}

{% block title %}Espace hébergés
{% endblock %}


{% block body %}

<body class="ltr app sidebar-mini">
	<!-- GLOBAL-LOADER -->
	<div id="global-loader">
		<img src="../assets/images/loader.svg" class="loader-img" alt="Loader">
	</div>
	<!-- /GLOBAL-LOADER -->

	<!-- PAGE -->
	<div class="page">
		<div class="page-main">

			<!-- Header -->
			{% include "commun/header.html.twig" %}
			<!-- /Header -->

			<!-- SIDEBAR -->
			{% include "commun/side-bar-admin.html.twig" %}
			<!-- /SIDEBAR -->

			<!-- content open -->
			<div class="app-content main-content mt-0">
				<div class="side-app">
					<!-- CONTAINER -->
					<div class="main-container container-fluid">
						<!-- PAGE-HEADER -->
						<div class="page-header">
							<div>
								<h1 class="page-title">Espace hébergés</h1>
							</div>
							<div class="ms-auto pageheader-btn">
								<ol class="breadcrumb">
									<li class="breadcrumb-item">
										<a href="javascript:void(0);">Home</a>
									</li>
									<li class="breadcrumb-item active" aria-current="page">Espace hébergés</li>
								</ol>
							</div>
						</div>
						<!-- PAGE-HEADER END -->

						<div class="row">
							<div class="row row-sm">
								<div class="col-lg-12">
									<div class="card">
										<div class="card-header border-bottom">
											<h3 class="card-title">Liste des hébergés</h3>
										</div>
										<div class="card-body">
											<div class="table-responsive export-table">
												<table id="editable-file-datatable"
													class="table table-nowrap table-bordered wp-100">
													<thead>
														<tr>
															<th>N° Bénéficiaire</th>
															<th>Nom et Prénom</th>
															<th>Date d'inscription</th>
															<th>Adresse mail</th>
														</tr>
													</thead>
													<tbody>
														{% for personne in personne %}
														{% if 'ROLE_USER' in personne.codeRoles %}
														<tr data-id="1">
															<td data-field="numero_beneficiaire">{{
																personne.numeroBeneficiaire}}</td>
															<td data-field="nom">{{ personne.nom }} {{ personne.prenom
																}}</td>
															<td data-field="date_inscription">{{
																personne.dateNaissance|date('d-m-Y') }}</td>
															<td data-field="email">{{ personne.email}}</td>
															<td class="text-muted fs-14 fw-semibold">
																<a href="" class="btn btn-primary-light "
																	id="show-details-btn"
																	data-bs-target="#Vertically{{personne.idPersonne}}"
																	data-bs-toggle="modal">Plus d'infos</a>
															</td>
														</tr>
														{% endif %}
														{% endfor %}
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- MODAL -->
						{% for personne in personne %}
						{% if 'ROLE_USER' in personne.codeRoles %}
						<div class="modal fade" id="Vertically{{personne.idPersonne}}">
							<div class="modal-dialog modal-dialog-centered task-view-modal" role="document">
								<div class="modal-content modal-content-demo">

									<div class="modal-header p-5">
										<h4 class="modal-title text-dark">Informations Hébergé</h4>
										<button aria-label="Close" class="btn-close" data-bs-dismiss="modal"
											type="button">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>

									<div class="modal-body">
										<div class="row">
											<form id="formModification">
												<div class="col-md-12 d-flex mb-4">
													<p class="m-0 wp-30 text-muted">Nom</p>
													<div class="m-0 wp-70 text-dark d-flex align-items-center">
														<div>
															<input type="text" class="form-control m-0 wp-70 text-dark"
																id="modalNom" value="{{ personne.nom|upper }}" disabled>
														</div>
													</div>
												</div>
												<div class="col-md-12 d-flex mb-4">
													<p class="m-0 wp-30 text-muted">Prénom</p>
													<div class="m-0 wp-70 text-dark d-flex align-items-center">
														<div>
															<input type="text" class="form-control m-0 wp-70 text-dark"
																id="modalPrenom" value="{{ personne.prenom }}" disabled>
														</div>
													</div>
												</div>
												<div class="col-md-12 d-flex mb-4">
													<p class="m-0 wp-30 text-muted">Date de naissance</p>
													<input type="text" class="form-control m-0 wp-70 text-dark"
														id="modalDateNaissance"
														value="{{ personne.dateNaissance|date('d-m-Y') }}" disabled>
												</div>
												<div class="col-md-12 d-flex mb-4">
													<p class="m-0 wp-30 text-muted">Numéro de bénéficiaire</p>
													<input type="text" class="form-control m-0 wp-70 text-dark"
														id="modalNumeroBeneficiaire"
														value="{{personne.numeroBeneficiaire}}" disabled>
												</div>
												<div class="col-md-12 d-flex mb-4">
													<p class="m-0 wp-30 text-muted">Numéro de téléphone</p>
													<input type="text" class="form-control m-0 wp-70 text-dark"
														id="modalNumeroTelephone" value="{{personne.numTelephone}}"
														disabled>
												</div>
												<div class="col-md-12 d-flex mb-4">
													<p class="m-0 wp-30 text-muted">Adresse mail</p>
													<input type="text" class="form-control m-0 wp-70 text-dark"
														id="modalEmail" value="{{personne.email}}" disabled>
												</div>
												<div class="col-md-12 d-flex mb-4">
													<p class="m-0 wp-30 text-muted">Date d'inscription</p>
													<input type="text" class="form-control m-0 wp-70 text-dark"
														id="modalDateInscription"
														value="{{ personne.dateInscription|date('d-m-Y') }}" disabled>
												</div>
												<div class="col-md-12 d-flex mb-4">
													<p class="m-0 wp-30 text-muted">Numéro de chambre</p>
													<p class="m-0 wp-70 text-dark">12</p>
												</div>
												<div class="col-md-12 d-flex mb-4">
													<p class="m-0 wp-30 text-muted">Début de location</p>
													<p class="m-0 wp-70 text-dark">---</p>
												</div>
												<div class="col-md-12 d-flex mb-4">
													<p class="m-0 wp-30 text-muted">Fin de location</p>
													<p class="m-0 wp-70 text-dark">---</p>
												</div>
												<div class="d-flex justify-content-end">
													<a href="#"
														class="btn btn-secondary mb-5 m-3 d-none sauvegarderBtns">Sauvegarder</a>
													<a href="#"
														class="btn btn-outline-primary mb-5 m-3 modifierBtn">Modifier</a>
													<a href="#"
														class="btn btn-outline-danger mb-5 m-3 supprimerBtns">Supprimer</a>
												</div>
											</form>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	{% endif %}
	{% endfor %}
	<!-- MODAL ENDS -->

	<!-- FOOTER -->
	{% include "commun/footer.html.twig" %}
	<!-- FOOTER END -->

	<!-- BACK-TO-TOP -->
	<a href="#top" id="back-to-top">
		<i class="fa fa-long-arrow-up"></i>
	</a>
	{% block javascript %}
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			let modifierBtns = document.querySelectorAll('.modifierBtn');
			let sauvegarderBtns = document.querySelectorAll('.sauvegarderBtns');
			let supprimerBtns = document.querySelectorAll('.supprimerBtns');

			modifierBtns.forEach(function (modifierBtn, index) {
				modifierBtn.addEventListener('click', function () {
					// Récupérez le modal parent du bouton cliqué
					let modal = modifierBtn.closest('.modal');

					let modalInputs = modal.querySelectorAll('input');


					modalInputs.forEach(function (input) {
						input.removeAttribute('disabled');
					});


					sauvegarderBtns[index].classList.remove('d-none');
				});

				sauvegarderBtns[index].addEventListener('click', function () {
					Swal.fire({
						title: "Voulez-vous enregistrer les modifications ?",
						showDenyButton: true,
						showCancelButton: true,
						confirmButtonText: "Enregistrer",
						denyButtonText: `Ne pas enregistrer`
					}).then((result) => {
						if (result.isConfirmed) {
							Swal.fire("Enregistré !", "", "success");
							// Envoyez ici votre requête AJAX pour sauvegarder les modifications
							// Vous pouvez utiliser l'ID de la personne liée à ce modal
							// Après avoir enregistré les modifications, vous pouvez masquer à nouveau le bouton "Sauvegarder"
							sauvegarderBtns[index].classList.add('d-none');
							// Désactivez les champs d'entrée à nouveau
							let modal = modifierBtn.closest('.modal');
							let modalInputs = modal.querySelectorAll('input');
							modalInputs.forEach(function (input) {
								input.setAttribute('disabled', true);
							});
						} else if (result.isDenied) {
							Swal.fire("Les modifications ne sont pas enregistrées", "", "info");
							// Réinitialisez ici les champs du formulaire si nécessaire
							// Vous pouvez ajouter du code pour réinitialiser les champs si l'utilisateur choisit de ne pas enregistrer
						}
					});
				});

				supprimerBtns[index].addEventListener('click', function () {
					Swal.fire({
						title: "Êtes vous sûr de vouloir supprimer ce locataire?",
						text: "Le locataire sera supprimé de la base de données!",
						icon: "warning",
						showCancelButton: true,
						confirmButtonColor: "#3085d6",
						cancelButtonColor: "#d33",
						confirmButtonText: "Je valide !",
						cancelButtonText: "Annuler"
					}).then((result) => {
						if (result.isConfirmed) {
							Swal.fire({
								title: "Supprimé !",
								text: "Le locataire à bien été supprimé.",
								icon: "success"
							});
						}
					});
				});
			});
		});
	</script>
	{% endblock %}
</body>
{% endblock %}